---
// src/pages/upload.astro
---

<form id="upload-form" enctype="multipart/form-data">
  <input type="file" name="file" required />
  <button type="submit">Upload Image</button>
</form>

<div id="preview"></div>

<script>
  // funci√≥n que maneja el submit del formulario
  async function handleSubmit(event) {
    event.preventDefault();

    const form = document.getElementById("upload-form");
    const formData = new FormData(form);

    // enviamos la imagen al backend
    const res = await fetch("/api/upload", {
      method: "POST",
      body: formData,
    });

    const data = await res.json();
    const preview = document.getElementById("preview");

    if (res.ok && data.url) {
      // mostramos la imagen subida
      preview.innerHTML = `<p>Uploaded!</p><img src="${data.url}" alt="Uploaded Image" style="max-width:300px;" />`;
    } else {
      preview.textContent = "Error uploading: " + (data.error || "Unknown");
    }
  }

  // atamos el handler al formulario
  document
    .getElementById("upload-form")
    .addEventListener("submit", handleSubmit);
</script>
